<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Master - Direction Fixed ğŸš€</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #ff9f43; --success: #28c76f; --danger: #ff4757; --bg: #f8faff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; }
        #game-container { max-width: 850px; width: 95%; background: white; margin: 20px; padding: 25px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 20px; margin-bottom: 25px; }
        
        .btn { background: var(--primary); color: white; border: none; padding: 14px 28px; font-size: 1.2rem; border-radius: 15px; cursor: pointer; margin: 8px; font-weight: bold; transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }

        /* ×ª×™×§×•×Ÿ ×›×™×•×•×Ÿ ×œ××™×œ×™× ×‘×× ×’×œ×™×ª */
        .english-text { direction: ltr; display: inline-block; unicode-bidi: bidi-override; }
        
        .word-card { font-size: 3rem; color: #333; margin: 15px; font-weight: 800; }
        .detective-word { font-size: 3.5rem; letter-spacing: 8px; color: var(--primary); font-family: 'Courier New', Courier, monospace; direction: ltr; display: inline-block; }
        
        .letter-pool { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; direction: ltr; }
        .letter-btn { background: #eee; border: 2px solid #ccc; padding: 12px 18px; font-size: 1.5rem; border-radius: 10px; cursor: pointer; font-weight: bold; width: 55px; }
        
        /* ×ª×™×§×•×Ÿ ×›×™×•×•×Ÿ ×œ×‘× ×™×™×ª ××©×¤×˜×™× */
        .sentence-builder { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin: 15px; min-height: 80px; padding: 15px; border-radius: 20px; background: #f0f7ff; direction: ltr; }
        #sentence-slots { border: 2px dashed var(--primary); background: #fff; }
        
        .word-tile { background: white; border: 2px solid var(--primary); padding: 12px 20px; border-radius: 12px; cursor: pointer; font-weight: bold; user-select: none; direction: ltr; }
        
        .progress-bar { width: 100%; height: 12px; background: #eee; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; transition: 0.4s; }
        .hidden { display: none; }
        .feedback { font-size: 1.5rem; font-weight: bold; margin: 15px; height: 35px; }
        
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 20px auto; max-width: 600px; }
        .memory-card { aspect-ratio: 1; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .memory-card.flipped { background: white; color: var(--primary); border: 2px solid var(--primary); direction: ltr; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="header">
        <h1>English Master Class ğŸ“</h1>
        <p>××ª××× ×™× × ×›×•×Ÿ ×•×× ×¦×—×™×!</p>
    </div>

    <div id="start-screen">
        <h3>×‘×—×¨×• ××©×—×§:</h3>
        <button class="btn" onclick="initSpelling()">âœï¸ ×”×›×ª×‘×”</button>
        <button class="btn" onclick="initDetective()">ğŸ” ×‘×œ×© ×”××•×ª×™×•×ª</button>
        <button class="btn" onclick="initGrammar()">ğŸ§ Is ××• Are?</button>
        <button class="btn" onclick="initSentence()">ğŸ—ï¸ ×‘× ×™×™×ª ××©×¤×˜×™×</button>
        <button class="btn" onclick="initMemory()">ğŸ§  ×–×™×›×¨×•×Ÿ</button>
    </div>

    <div id="detective-game" class="hidden">
        <p>×”×©×œ×™××• ××ª ×”××•×ª×™×•×ª ×”×—×¡×¨×•×ª ×‘××™×œ×” (××©×××œ ×œ×™××™×Ÿ):</p>
        <div id="detective-hebrew" class="word-card"></div>
        <div id="detective-word-display" class="detective-word"></div>
        <div id="letter-pool" class="letter-pool"></div>
        <div id="detective-feedback" class="feedback"></div>
        <button class="btn" style="background:#999" onclick="goBack()">×ª×¤×¨×™×˜</button>
    </div>

    <div id="spelling-game" class="hidden">
        <div class="progress-bar"><div id="spell-progress" class="progress-fill"></div></div>
        <div id="hebrew-word" class="word-card"></div>
        <input type="text" id="spell-input" style="direction: ltr;" placeholder="Type here..." autocomplete="off">
        <div id="spell-feedback" class="feedback"></div>
        <button class="btn" onclick="checkSpelling()">×‘×“×™×§×”</button>
        <button class="btn" style="background:#999" onclick="goBack()">×ª×¤×¨×™×˜</button>
    </div>

    <div id="sentence-game" class="hidden">
        <p>×¡×“×¨×• ××ª ×”××™×œ×™× ××©×××œ ×œ×™××™×Ÿ:</p>
        <div id="sentence-hint" style="font-size: 1.5rem; color: #444; font-weight: bold; margin-bottom:10px;"></div>
        <div id="sentence-slots" class="sentence-builder"></div>
        <div id="sentence-options" class="sentence-builder"></div>
        <div id="sent-feedback" class="feedback"></div>
        <button class="btn" onclick="checkSentence()">×‘×“×™×§×” âœ…</button>
        <button class="btn" style="background:#999" onclick="goBack()">×—×–×¨×”</button>
    </div>

    <div id="grammar-game" class="hidden">
        <div id="gram-word" class="word-card english-text"></div>
        <div style="display:flex; justify-content:center; gap:15px; direction: ltr;">
            <button class="btn" onclick="checkGrammar('is')">There is</button>
            <button class="btn" onclick="checkGrammar('are')">There are</button>
        </div>
        <div id="gram-feedback" class="feedback"></div>
        <button class="btn" style="background:#999" onclick="goBack()">×—×–×¨×”</button>
    </div>

    <div id="memory-game" class="hidden">
        <div id="memory-grid" class="memory-grid"></div>
        <button class="btn" style="background:#999" onclick="goBack()">×—×–×¨×”</button>
    </div>

    <div id="win-screen" class="hidden">
        <h2 style="color: var(--success); font-size: 3rem;">×›×œ ×”×›×‘×•×“! ğŸ†</h2>
        <button class="btn" onclick="location.reload()">×©×—×§×• ×©×•×‘</button>
    </div>
</div>

<script>
    const baseVocabulary = [
        {en: 'dress', he: '×©××œ×”', type: 'is'}, {en: 'children', he: '×™×œ×“×™×', type: 'are'},
        {en: 'ice-cream', he: '×’×œ×™×“×”', type: 'is'}, {en: 'boots', he: '××’×¤×™×™×', type: 'are'},
        {en: 'pants', he: '××›× ×¡×™×™×', type: 'are'}, {en: 'shoes', he: '× ×¢×œ×™×™×', type: 'are'},
        {en: 'socks', he: '×’×¨×‘×™×™×', type: 'are'}, {en: 'shirt', he: '×—×•×œ×¦×”', type: 'is'},
        {en: 'store', he: '×—× ×•×ª', type: 'is'}, {en: 'they', he: '×”×/×”×Ÿ'},
        {en: 'I want', he: '×× ×™ ×¨×•×¦×”'}, {en: 'I don\'t want', he: '×× ×™ ×œ× ×¨×•×¦×”'},
        {en: 'cloud', he: '×¢× ×Ÿ', type: 'is'}, {en: 'sky', he: '×©××™×™×', type: 'is'}
    ];

    const baseSentences = [
        {he: '×™×© ××’×¤×™×™× ×‘×—× ×•×ª', en: ['There', 'are', 'boots', 'in', 'the', 'store']},
        {he: '×™×© ×—× ×•×ª ×’×œ×™×“×”', en: ['There', 'is', 'an', 'ice', 'cream', 'store']},
        {he: '×™×© ×—××™×©×” ×™×œ×“×™× ×‘×‘×¨×™×›×”', en: ['There', 'is', 'five', 'children', 'in', 'the', 'pool']}
    ];

    let gameVocab = [], currentIdx = 0, builtSentence = [], poolWords = [];
    let detectiveCurrentWord = "", detectiveMissingIndices = [];

    function shuffle(array) {
        let arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function showScreen(id) {
        document.querySelectorAll('#game-container > div:not(.header)').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }
    function goBack() { showScreen('start-screen'); }

    // --- Detective Logic (Direction Fixed) ---
    function initDetective() {
        gameVocab = shuffle(baseVocabulary);
        currentIdx = 0;
        showScreen('detective-game');
        nextDetective();
    }

    function nextDetective() {
        if(currentIdx >= gameVocab.length) return showScreen('win-screen');
        detectiveCurrentWord = gameVocab[currentIdx].en;
        detectiveMissingIndices = [];
        let numToHide = detectiveCurrentWord.length > 5 ? 3 : 2;
        while(detectiveMissingIndices.length < numToHide) {
            let rand = Math.floor(Math.random() * detectiveCurrentWord.length);
            if(detectiveCurrentWord[rand] !== " " && detectiveCurrentWord[rand] !== "-" && !detectiveMissingIndices.includes(rand)) {
                detectiveMissingIndices.push(rand);
            }
        }
        renderDetective();
    }

    function renderDetective() {
        document.getElementById('detective-hebrew').innerText = gameVocab[currentIdx].he;
        let displayStr = "";
        for(let i=0; i<detectiveCurrentWord.length; i++) {
            displayStr += detectiveMissingIndices.includes(i) ? "_" : detectiveCurrentWord[i];
        }
        document.getElementById('detective-word-display').innerText = displayStr;
        
        let pool = detectiveMissingIndices.map(i => detectiveCurrentWord[i]);
        const alphabet = "abcdefghijklmnopqrstuvwxyz";
        while(pool.length < 8) {
            let r = alphabet[Math.floor(Math.random() * 26)];
            if(!pool.includes(r)) pool.push(r);
        }
        pool = shuffle(pool);
        const pc = document.getElementById('letter-pool');
        pc.innerHTML = "";
        pool.forEach(l => {
            let b = document.createElement('button'); b.className = 'letter-btn'; b.innerText = l;
            b.onclick = () => {
                let found = false;
                for(let i=0; i<detectiveMissingIndices.length; i++) {
                    if(detectiveCurrentWord[detectiveMissingIndices[i]].toLowerCase() === l.toLowerCase()) {
                        detectiveMissingIndices.splice(i, 1); found = true; break;
                    }
                }
                if(found) { renderDetective(); if(detectiveMissingIndices.length === 0) { currentIdx++; setTimeout(nextDetective, 800); } }
            };
            pc.appendChild(b);
        });
    }

    // --- Other Games (Directions Verified) ---
    function initSpelling() { gameVocab = shuffle(baseVocabulary); currentIdx = 0; showScreen('spelling-game'); nextSpell(); }
    function nextSpell() {
        if(currentIdx >= gameVocab.length) return showScreen('win-screen');
        document.getElementById('hebrew-word').innerText = gameVocab[currentIdx].he;
        document.getElementById('spell-input').value = ""; document.getElementById('spell-progress').style.width = (currentIdx/gameVocab.length)*100 + '%';
    }
    function checkSpelling() {
        if(document.getElementById('spell-input').value.toLowerCase().replace(/[^a-z]/g, "") === gameVocab[currentIdx].en.toLowerCase().replace(/[^a-z]/g, "")) {
            currentIdx++; nextSpell();
        }
    }

    function initGrammar() { gameVocab = shuffle(baseVocabulary.filter(v => v.type)); currentIdx = 0; showScreen('grammar-game'); nextGram(); }
    function nextGram() {
        if(currentIdx >= gameVocab.length) return showScreen('win-screen');
        document.getElementById('gram-word').innerText = gameVocab[currentIdx].en;
    }
    function checkGrammar(choice) {
        if(choice === gameVocab[currentIdx].type) { currentIdx++; nextGram(); }
    }

    function initSentence() { gameSentences = shuffle(baseSentences); currentIdx = 0; showScreen('sentence-game'); nextSent(); }
    function nextSent() {
        if(currentIdx >= gameSentences.length) return showScreen('win-screen');
        builtSentence = []; poolWords = shuffle(gameSentences[currentIdx].en);
        document.getElementById('sentence-hint').innerText = gameSentences[currentIdx].he;
        renderSentence();
    }
    function renderSentence() {
        const slots = document.getElementById('sentence-slots'), opts = document.getElementById('sentence-options');
        slots.innerHTML = ''; opts.innerHTML = '';
        builtSentence.forEach((w, i) => {
            let d = document.createElement('div'); d.className = 'word-tile'; d.innerText = w;
            d.onclick = () => { poolWords.push(builtSentence.splice(i, 1)[0]); renderSentence(); };
            slots.appendChild(d);
        });
        poolWords.forEach((w, i) => {
            let d = document.createElement('div'); d.className = 'word-tile'; d.innerText = w;
            d.onclick = () => { builtSentence.push(poolWords.splice(i, 1)[0]); renderSentence(); };
            opts.appendChild(d);
        });
    }
    function checkSentence() {
        if(builtSentence.join(' ') === gameSentences[currentIdx].en.join(' ')) { currentIdx++; nextSent(); }
    }

    function initMemory() {
        showScreen('memory-game'); const grid = document.getElementById('memory-grid'); grid.innerHTML = '';
        let items = []; shuffle(baseVocabulary).slice(0, 6).forEach(v => { items.push({t: v.en, p: v.he}, {t: v.he, p: v.en}); });
        items = shuffle(items); let m1 = null;
        items.forEach(item => {
            let c = document.createElement('div'); c.className = 'memory-card'; c.innerText = 'â“';
            c.onclick = () => {
                if(c.classList.contains('flipped') || m1?.c === c) return;
                c.innerText = item.t; c.classList.add('flipped');
                if(!m1) m1 = {c, i: item};
                else {
                    if(m1.i.p === item.t) m1 = null;
                    else { let c1 = m1.c; setTimeout(() => { c1.innerText = 'â“'; c.innerText = 'â“'; c1.classList.remove('flipped'); c.classList.remove('flipped'); }, 800); m1 = null; }
                }
            };
            grid.appendChild(c);
        });
    }
</script>
</body>
</html>
